<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Planilha de Vendas</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="main-container">
    <div class="header">
      <h1>Planilha de Vendas</h1>
    </div>

    <div class="spreadsheet-container">
      <table class="spreadsheet-table">
        <thead>
          <tr>
            <th>Funcionário</th>
            <th>Segunda</th>
            <th>Terça</th>
            <th>Quarta</th>
            <th>Quinta</th>
            <th>Sexta</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody id="vendas-body"></tbody>
        <tfoot>
          <tr class="daily-totals">
            <td class="employee-name">Total Diário</td>
            <td id="total-monday">R$ 0,00</td>
            <td id="total-tuesday">R$ 0,00</td>
            <td id="total-wednesday">R$ 0,00</td>
            <td id="total-thursday">R$ 0,00</td>
            <td id="total-friday">R$ 0,00</td>
            <td id="total-geral">R$ 0,00</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

  <!-- Firebase + Firestore -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAU0mGexI8c7UIdjlCScimOhxjkCW13qaI",
      authDomain: "vendas-on-f3ae1.firebaseapp.com",
      projectId: "vendas-on-f3ae1",
      storageBucket: "vendas-on-f3ae1.appspot.com",
      messagingSenderId: "645658657777",
      appId: "1:645658657777:web:7cad80b0a4cb452873ba50",
      measurementId: "G-QN7HK21M2H"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function formatCurrency(value) {
      return `R$ ${value.toFixed(2).replace('.', ',')}`;
    }

    document.addEventListener('DOMContentLoaded', async function () {
      const tbody = document.getElementById('vendas-body');

      let totalMonday = 0, totalTuesday = 0, totalWednesday = 0, totalThursday = 0, totalFriday = 0, totalGeral = 0;

      try {
        const querySnapshot = await getDocs(collection(db, "vendas"));
        querySnapshot.forEach((doc) => {
          const dados = doc.data();
          const totalFuncionario =
            dados.segunda + dados.terca + dados.quarta + dados.quinta + dados.sexta;

          totalMonday += dados.segunda;
          totalTuesday += dados.terca;
          totalWednesday += dados.quarta;
          totalThursday += dados.quinta;
          totalFriday += dados.sexta;
          totalGeral += totalFuncionario;

          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="employee-name">${dados.funcionario}</td>
            <td>${formatCurrency(dados.segunda)}</td>
            <td>${formatCurrency(dados.terca)}</td>
            <td>${formatCurrency(dados.quarta)}</td>
            <td>${formatCurrency(dados.quinta)}</td>
            <td>${formatCurrency(dados.sexta)}</td>
            <td class="total-cell">${formatCurrency(totalFuncionario)}</td>
          `;
          tbody.appendChild(row);
        });

        document.getElementById('total-monday').textContent = formatCurrency(totalMonday);
        document.getElementById('total-tuesday').textContent = formatCurrency(totalTuesday);
        document.getElementById('total-wednesday').textContent = formatCurrency(totalWednesday);
        document.getElementById('total-thursday').textContent = formatCurrency(totalThursday);
        document.getElementById('total-friday').textContent = formatCurrency(totalFriday);
        document.getElementById('total-geral').textContent = formatCurrency(totalGeral);
      } catch (error) {
        console.error("Erro ao buscar dados do Firestore:", error);
        tbody.innerHTML = `<tr><td colspan="7">Erro ao carregar dados</td></tr>`;
      }
    });
  </script>
</body>
</html>